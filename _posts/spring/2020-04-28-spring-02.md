---
title:  "springboot 연습 01"
excerpt: "springboot 연습 01"
classes: wide
categories:
  - spring
tags:
  - [springboot, aop, REST, API, RESTful]
last_modified_at: 2020-04-20
---



# SpringBoot (6장 ~ 10장)

##### 파일 업로드

* 스프링에서 제공하는 인터페이스 : MultipartResolver
* 구현체는 다음과 같다
  * 아파치의 Common Fileupload를 이용한 CommonMultipartResolver (실습에선 이거 사용)
  * 서블릿 3.0 이상의 API를 이용한 StandardServletMultipartResolver



##### @SpringBootApplication

* @SpringBootApplication 은 세 개의 어노테이션으로 구성

| 어노테이션               | 설명                                                         |
| ------------------------ | ------------------------------------------------------------ |
| @SpringBootConfiguration | spring boot 자동화 기능(spring 설정)을 활성화                |
| @ComponentScan           | 패키지 내 @Configuration, @Repository, @Controller, @Service, @RestController가 붙은 클래스 찾아서 빈으로 등록. |
| @EnableAutoConfiguration | 미리 정의되어 있는 빈들을 가져와서 등록. Spring의 META-INF 파일을 읽어들인다. 즉, 환경 설정에 필요한 자동 설정을 Bean으로 등록해준다. |

`Bean` 이 `@ComponentScan`과 `@EnableAutoConfiguration`에 의해 두 단계로 나눠서 읽힌다.

##### Spring @Configuration, @Component 차이점

* @Configuration은 Bean을 생성 할 때 Single Tone으로 한번만 생성하고 @Component는 Bean을 생성 할 때 java에서 new로 생성하듯이 생성한다.



#### 파일 형식 확인

* 파일의 확장자를 파일 이름에서 가져오는 방식은 위험
* 확자는 쉽게 바꿀 수 있기 때문에 실제 파일의 형식과 확장자가 다를 수 있고 위변조 확인 불가능
* 실제 개발은 JDK 1.7 이상에서 지원하는 nio 패키지를 이용하거나 아파치 티카같은 라이브러리 이용



####  userGeneratedKeys, keyProPerty

```xml
<insert id="insertBoard" parameterType="board.board.dto.BoardDto" useGeneratedKeys="true" keyProperty="boardIdx">
```

* useGeneratedKeys 속성은 DBMS가 자동생성키 제공할 경우 사용 가능
* keyProperty는 useGeneratedKeys나 selectKey 하위 엘리먼트에 의해 리턴되는 키를 의미
* 게시글의 경우 board_idx 컬럼이 PK이면서 자동 생성이 되게끔 했기 때문에 이 컬럼을 사용

* 즉, DB에 새로운 게시글이 등록되면 파라미터인 BoardDto 클래스의 boardIdx에 새로운 게시글 번호가 저장되어 반환된다.



## RESTFULL API

* REST란 REpresentational State Transfer의 약자로 HTTP 창시자 중 한 사람인 로이 필딩이 소개
* 기존의 웹 아키텍처가 HTTP의 우수성을 활용하지 못한다고 생각
* 그 장점을 최대한 활용할 수 있는 아키텍처로 REST를 소개

* 한마디로 정의하기 힘듬. 아래는 저자의 생각

> 잘 표현된 HTTP URI로 리소스를 정의하고 HTTP 메소드로 리소스에 대한 행위를 정의한다.
>
> 리소스는 JSON, XML과 같은 여러가지 언어로 표현 가능



#### 리소스

* 리소스는 서비스를 제공하는 시스템의 자원을 의미. URI로 정의
* 즉, REST API의 URI는 리소스의 자원을 표현해야 한다.
* 일반적으로 다음과 같은 규칙을 가짐

1. URI는 명사를 사용

2. 슬래시(/)로 계층 관계를 나타낸다.

3. URI의 마지막에는 슬래시를 사용하지 않는다.

4. URI는 소문자로만 작성한다

5. 가독성을 위해 하이픈(-)은 사용하나 밑줄(_)은 사용하지 않는다



#### HTTP 메서드

HTTP 메서드에는 여러가지가 있는데 REST에서는 4개만 사용

| HTTP 메서드 | 의미   | 역할                   |
| ----------- | ------ | ---------------------- |
| POST        | Create | 리소스 생성            |
| GET         | Read   | 해당 URI의 리소스 조회 |
| PUT         | Update | 해당 URI의 리소스 수정 |
| DELETE      | Delete | 해당 URI의 리소스 삭제 |

* 그외 메서드

| HTTP 메서드 | 역할                                                         |
| ----------- | ------------------------------------------------------------ |
| HEAD        | 문서 정보 요청. body 없이 http 헤더만 보냄                   |
| OPTION      | 웹 서버측 제공 메소드에 대한 질의                            |
| TRACE       | 요청 리소스가 수신되는 경로를 보여줌                         |
| CONNECT     | 프록시 서버와 같은 중간 서버 경유. SSL(HTTPS)를 사용하는 웹 사이트 접속하는데 사용 |

* HTML에서는 GET, POST만 지원. 스프링은 웹 브라우저에서 사용되는 POST, GET 방식을 이용해서 PUT과 DELETE 방식을 사용할 수 있는 기능을 지원. 
* HiddenHttpMethodFilter가 바로 그것. 스프링부트 2.1.x부터는 자동 등록되어 있음.

```javascript
<script type="text/javascript">
		$(document).ready(function(){
			/* 여기 */
			var boardIdx = $("#boardIdx").val();
			
			$("#list").on("click", function(){
				/* 여기 */
				location.href = "/board/";
			});
			
			$("#edit").on("click", function(){
				/* 여기 */
				$("#method").val("put");
				
				var frm = $("#frm")[0];
				frm.action = "/board/"+boardIdx;
				frm.submit();
			});
			
			$("#delete").on("click", function(){
				/* 여기 */
				$("#method").val("delete");
				
				var frm = $("#frm")[0];
				frm.action = "/board/"+boardIdx;
				frm.submit();
			});
		});
</script>
```

* HiddenHttpMethodFilter는 _method라는 이름의 파라미터가 존재할 경우 그 값을 요청 방식으로 사용 함
* 즉, _method 값을 PUT으로 보내면 컨트롤러에서 RequestMethod.PUT의 값을 가진 URI가 호출

* 이건 인터넷에서 찾아보니 GET, POST 방식 이외에는 보안이 취약해서 사용을 권장하지 않는다고 한다.



##### @PathVariable

* 메서드의 파라미터가 URI 변수로 사용되는 것을 의미

```java
// 게시글 번호가 URI의 {boardIdx}에 바인드
// 예를 들어 boardIdx가 1인 경우 /board/1이 된다.
@RequestMapping(value="/board/{boardIdx}", method=RequestMethod.GET)
public ModelAndView openBoardDetail(@PathVariable("boardIdx") int boardIdx, ModelMap model) throws Exception{
    ModelAndView mv = new ModelAndView("/board/restBoardDetail");

    BoardDto board = boardService.selectBoardDetail(boardIdx);
    mv.addObject("board", board);

    return mv;
}
```



##### @RestController

* @Controller와 @ResponseBody를 합친 것
* 해당 API의 응답 결과를 응답 body를 이용해서 보내줌
* 서버와 클라이언트는 일반적으로 JSON 방식 사용. 그래서 JSON을 사용



##### GET, POST 사용시 주의점

* GET은 요청 주소에 파라미터를 같이 보냄
* POST는 HTTP 패킷의 파라미터를 같이 보냄
* @RequestBody는 메서드의 파라미터가 반드시 HTTP 패킷의 바디에 담겨있어야 한다는 것을 의미
* GET은 @RequestParam을 사용